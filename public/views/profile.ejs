<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>OCM || Profile</title>
  <meta name="robots" content="noindex, follow" />
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="Cache-control" content="private">
  <meta name="theme-style-mode" content="0"> <!-- 0 == light, 1 == dark -->

  <!-- Favicon -->
  <link rel="shortcut icon" type="image/x-icon" href="assets/images/favicon.png">
  <!-- CSS 
    ============================================ -->
  <link rel="stylesheet" href="assets/css/vendor/bootstrap.min.css">
  <link rel="stylesheet" href="assets/css/vendor/slick.css">
  <link rel="stylesheet" href="assets/css/vendor/slick-theme.css">
  <link rel="stylesheet" href="assets/css/vendor/nice-select.css">
  <link rel="stylesheet" href="assets/css/plugins/feature.css">
  <link rel="stylesheet" href="assets/css/plugins/jquery-ui.min.css">
  <script src="//cdn.jsdelivr.net/npm/hls.js@latest"></script>

  <!-- Style css -->
  <link rel="stylesheet" href="assets/css/style.css">
  <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
</head>

<body class="template-color-1">
  <!-- Preloader -->
  <div class="preloader">
    <div class='loader'>
      <div class='circle'></div>
      <div class='circle'></div>
      <div class='circle'></div>
      <div class='circle'></div>
      <div class='circle'></div>
    </div>
  </div>

  <%- include('sections/header.ejs') -%>

  <div class="rn-author-bg-area bg_image--9 bg_image ptb--150">
    <div class="container">
      <div class="row">
      </div>
    </div>
  </div>

  <div class="rn-author-area mb--30 mt_dec--120">
    <div class="container">
      <div class="row padding-tb-50 align-items-center d-flex">
        <div class="col-lg-12">
          <div class="author-wrapper">
            <div class="author-inner">
              <div class="user-thumbnail">
                <img style="margin-right: 14px;" src="<%=profile_pic%>" alt="user profile image" onerror="this.src='https://www.ui-avatars.com/api/?background=random&length=3&font-size=0.33&uppercase=false&size=200&name=<%=user.wallet%>'">
                <a href="edit-profile" style="margin-left: -26px;margin-top:19px;z-index: 1;"><i style="margin-left: -32px;" class="icon i-edit"></i></a>
              </div>
              <div class="rn-author-info-content">
                <%if (user.project == undefined) {%>
                <h4 class="title"><%=user.wallet%></h4>
                <%} else {%>
                <h4 class="title"><%=user.project%></h4>
                <p class="wallet-copy"><a onclick="navigator.clipboard.writeText(`<%=user.wallet%>`)"><%=user.wallet%></a><i class="icon i-copy"></i></p>
                <%}%>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="rn-authore-profile-area">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <div class="tab-wrapper-one">
            <nav class="tab-button-one">
              <div class="nav nav-tabs" id="nav-tab" role="tablist">
                <button class="nav-link active" id="nav-home-tab" data-bs-toggle="tab" data-bs-target="#pane-listed-nfts" type="button" role="tab" aria-controls="nav-home" aria-selected="false">Listed</button>
                <% if (isOwner) {%>
                <button class="nav-link" id="nav-profile-tab" data-bs-toggle="tab" data-bs-target="#pane-unlisted-nfts" type="button" role="tab" aria-controls="nav-profile" aria-selected="true">Un-Listed</button>
                <button class="nav-link" id="nav-liked-tab" data-bs-toggle="tab" data-bs-target="#pane-liked-nfts" type="button" role="tab" aria-controls="nav-liked" aria-selected="false">Liked</button>
                <button class="nav-link" id="nav-offers-tab" data-bs-toggle="tab" data-bs-target="#pane-offers" type="button" role="tab" aria-controls="nav-accountOffers" aria-selected="false">Account Offers</button>
                <%if (isVerified) {%>
                <button class="nav-link dropdown" id="nav-offers-tab" data-bs-toggle="dropdown" type="button" role="tab" aria-controls="" aria-expanded="false">Verified Tools</button>
                <ul class="dropdown-menu">
                  <li><a href="create-collection" class="dropdown-item">Create Collection</a></li>
                </ul>
                <%}%>
                <%}%>
              </div>
              </nav>
            </div>
          </div>
        </div>

        <div id="pane-listed-nfts" class="tab-pane fade active show" aria-labelledby="nav-listed-tab" role="tabpanel">
          <%- include ("models/nft-rows.ejs", {nfts:nfts}) %>
          <%if (isMarker) {%>
          <div class="load-more-div">
            <button class="special-btn" id="moreListedNftsLoad">
              <i class="icon i-flashlight"></i>
              <span class="button-text">Find More</span>
              <span class="button-loader"></span>
            </button>
          </div>
          <%}%> 
      </div>
      <% if (isOwner) {%>
          <div id="pane-unlisted-nfts" class="tab-pane fade" aria-labelledby="nav-unlisted-tab" role="tabpanel">
            <div class="d-flex flex-row-reverse bd-highlight">
              <button class="btn btn-primary mb-3" id="bulkButton">
                List All
              </button>
            </div>
            <div class="unlisted-wrap" id="unlisted-nfts">
              <lottie-player src="assets/js/lottie/network.json" background="transparent" speed="1" style="margin:auto;width: 80px; height: 80px;" loop autoplay></lottie-player>
              <span class="loader-disclaimer">Querying the XRPL, please be patient</span>
            </div>
          </div>
          <div id="pane-liked-nfts" class="tab-pane fade" aria-labelledby="nav-liked-tab" role="tabpanel">
            <%- include ("models/nft-rows.ejs", {nfts: likedNfts}) %>
          </div>
          <div id="pane-offers" class="tab-pane fade" aria-labelledby="nav-offers-tab" role="tabpanel">
            <div class="offers-container-wrap">
              <% buyOffers.forEach(function(res){%>
              <%- include('models/account-offers.ejs', {offer:res})%>
              <%}); %>
              <% sellOffers.forEach(function(res){%>
              <%- include('models/account-offers.ejs', {offer:res})%>
              <%}); %>
            </div>
          </div>
          <%}%>
    </div>
  </div>
  <% if (isOwner) {%>
  <%if (queueCount > 0) {%>
  <div class="small-hover-tab-modal" alt="total Items in listing Queue">
    <p style="color: var(--color-white);">
      Items in Queue:
      <span>
        <%=queueCount%>
      </span>
    </p>
  </div>
  <%}%>
  <%}%>
  <div class="modal fade"  id="bulkListModal" tabindex="-1" aria-labelledby="bulkListModal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable">
      <div class="modal-content" id="bulkListModalContent">
        <div class="modal-header">
          <h5 class="modal-title" id="staticBackdropLabel">Bulk List</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="bulkModalBody">
          <div class="bulk-nft-container">
            <div class="bulk-nft-wrap skeleton" id="bulkNftWrap">
              <div class="token-id">
                <a href="" target="_blank" id="tokenId"></a>
              </div>
            </div>
            <div class="bulk-nft-wrap skeleton" id="bulkNftWrap">
              <div class="token-id">
                <a href="" target="_blank" id="tokenId"></a>
              </div>
            </div>
            <div class="bulk-nft-wrap skeleton" id="bulkNftWrap">
              <div class="token-id">
                <a href="" target="_blank" id="tokenId"></a>
              </div>
            </div>
            <div class="bulk-nft-wrap skeleton" id="bulkNftWrap">
              <div class="token-id">
                <a href="" target="_blank" id="tokenId"></a>
              </div>
            </div>
            <div class="bulk-nft-wrap skeleton" id="bulkNftWrap">
              <div class="token-id">
                <a href="" target="_blank" id="tokenId"></a>
              </div>
            </div>
          </div>                
        </div>
        <div class="modal-footer">
          <div class="bulk-modal-footer">
            <div class="xrp-calculator">
              <label for="bulkTotalXrp">Total = </label>
              <input type="number" id="bulkTotalXrp" value="" disabled>
              <label for="bulkTotalXrp"> XRP</label>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Modal require -->
  <%- include('sections/popup-modal.ejs') -%>
          <%- include('sections/footer.ejs') -%>
          <!-- Start Top To Bottom Area  -->
          <div class="rn-progress-parent">
            <svg class="rn-back-circle svg-inner" width="100%" height="100%" viewBox="-1 -1 102 102">
              <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98" />
            </svg>
          </div>
          <!-- End Top To Bottom Area  -->
          <!-- JS ============================================ -->
          <script src="assets/js/vendor/jquery.js"></script>
          <script src="assets/js/vendor/jquery.nice-select.min.js"></script>
          <script src="assets/js/vendor/jquery-ui.js"></script>
          <script src="assets/js/vendor/modernizer.min.js"></script>
          <script src="assets/js/vendor/feather.min.js"></script>
          <script src="assets/js/vendor/slick.min.js"></script>
          <script src="assets/js/vendor/bootstrap.min.js"></script>
          <script src="assets/js/vendor/sal.min.js"></script>
          <script src="assets/js/vendor/waypoint.js"></script>
          <script src="assets/js/vendor/wow.js"></script>
          <script src="assets/js/vendor/particles.js"></script>
          <script src="assets/js/vendor/jquery.style.swicher.js"></script>
          <script src="assets/js/vendor/js.cookie.js"></script>
          <script src="assets/js/vendor/count-down.js"></script>
          <script src="assets/js/vendor/counter-up.js"></script>
          <script src="assets/js/vendor/isotop.js"></script>
          <script src="assets/js/vendor/imageloaded.js"></script>
          <script src="assets/js/vendor/backtoTop.js"></script>
          <script src="assets/js/vendor/scrolltrigger.js"></script>
          <script src="assets/js/vendor/jquery.custom-file-input.js"></script>
          <script src="assets/js/vendor/savePopup.js"></script>
          <script src="assets/js/vendor/jquery.endless-scroll.js"></script>
          <!-- main JS -->
          <script src="assets/js/main.js"></script>
          <script>
            var markerIterationUnlisted = 0;
            var markerUnlisted = '<%=marker%>';
            var markerIteration = 0;
            var marker = '<%=marker%>';
            var isMarker = '<%=isMarker%>';
            var bulkListQuery = false;
            var arrayBool = false;
            $('#bulkButton').on('click', function() {
              $('#bulkListModal').modal('toggle')
              if (bulkListQuery != true) {
                $.get(`<%=url%>/bulk-list-account-unlisted-nfts`, function(returnData) {
                  $('#bulkListModalContent').html(returnData);
                  bulkListQuery = true;
                })
              }
            });
            $('#bulkListModalContent').on('click', '#modalListButtonBulk', function() {
              var nfts = [];
              var returnUrl = window.location.href;
              if (arrayBool == false) {
                for (var i = 0; i < $('.bulk-nft-container #bulkNftWrap').length; i++) {
                  if ($(`input.bulk-checkbox:eq(${i})`).is(':checked')) {
                    var value = $(`.bulk-checkbox:eq(${i})`).val().split(',')
                    nfts.push({
                      'NFTokenID': value[0],
                      'Issuer': value[1]
                    })
                  }
                }
                arrayBool = true;
                const formData = new FormData();
                formData.append('nfts', JSON.stringify(nfts));
                formData.append('returnUrl', returnUrl)
                if (nfts.length > 0) {
                  $.ajax({
                  type: "POST",
                  url: "/list-bulk-array-free",
                  processData: false,
                  contentType: false,
                  enctype: "multipart/form-data",
                  data: formData,
                  success: function(result) {
                    location.reload()
                  },
                  error: function() {
                    console.log('error')
                  }
                })
                }
              }
            })
            $('#bulkListModalContent').on('change', 'input', function() {
              $('#bulkTotalXrp').val($('.bulk-nft-container #bulkNftWrap .bulk-checkbox:checked').length * 0)
            })
            $('#moreListedNftsLoad').on('click', function() {
              document.getElementById('moreListedNftsLoad').classList.add('loading')
              document.getElementById('moreListedNftsLoad').disabled = true;
              $.get(
                `<%=url%>/get-additional-listed-nfts?wallet=<%=user.wallet%>&marker=${marker}&markerIteration=${markerIteration}`,
                function(data) {
                  markerIteration++;
                  $("#exploreSection").append(data[0])
                  marker = data[1]
                  const cards = document.getElementById("exploreSection").querySelectorAll(".col-5");
                  cards.forEach(element => {
                    element.classList.add("sal-animate")
                  });
                  document.getElementById('moreListedNftsLoad').classList.remove('loading')
                  document.getElementById('moreListedNftsLoad').disabled = false;
                }
              )
            })
            $("#unlisted-nfts").load("<%=url%>/get-account-unlisted-nfts?wallet=<%=user.wallet%>",
              function() {
                const cards = document.getElementById("pane-unlisted-nfts").querySelectorAll(".col-5");
                cards.forEach(element => {
                  element.classList.add("sal-animate")
                });
                if (isMarker) {
                  $('#pane-unlisted-nfts').append(`
      <div class="load-more-div">
            <button class="special-btn" id="moreUnlistedNftsLoad" onclick="loadMoreNfts(this)">
              <i class="icon i-flashlight"></i>
              <span class="button-text">Find More</span>
              <span class="button-loader"></span>
            </button>
          </div>
      `)
                }
              })

            function loadMoreNfts(elem) {
              $(elem).addClass('loading');
              $(elem).prop('disabled', true);
              $.get(`<%=url%>/get-additional-unlisted-nfts?wallet=<%=user.wallet%>&marker=${markerUnlisted}&markerIteration=${markerIterationUnlisted}`,
                function(returnData) {
                  markerUnlisted = returnData[1]
                  markerIterationUnlisted++;
                  $("#exploreSectionUnlisted").append(returnData[0])
                  markerUnlisted = returnData[1]
                  const cardsUnlisted = document.getElementById("pane-unlisted-nfts").querySelectorAll(".col-5");
                  cardsUnlisted.forEach(element => {
                    if (!$(element).hasClass("sal-animate")) {
                      element.classList.add("sal-animate");
                    }
                  });
                  $(elem).removeClass('loading');
                  $(elem).prop('disabled', false);
                }
              )
            }
          </script>
</body>

</html>